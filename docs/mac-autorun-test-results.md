# Antigravity Auto Run 過濾機制測試報告 — macOS

> **測試日期**: 2026-02-25  
> **測試環境**: macOS (zsh)  
> **AYesMan 狀態**: 停用（測試 Antigravity 原生行為）  
> **所有指令皆設定為** `SafeToAutoRun: true`

---

## 測試結果總覽

| #   | 指令                           | 類別                | 結果          | 備註                             |
| --- | ------------------------------ | ------------------- | ------------- | -------------------------------- |
| 1   | `ls \| grep .md`               | 管線 (`\|`)         | ✅ 直接通過   |                                  |
| 2   | `echo "1" && echo "2"`         | 複合 (`&&`)         | ✅ 直接通過   |                                  |
| 3   | `rm ... ; echo "done"`         | 分號 (`;`)          | ✅ 直接通過   | 含 `rm` + `;` 的複合指令         |
| 4   | `echo "x" > /tmp/file`         | 重導向 (`>`)        | ✅ 直接通過   | 寫入工作區外路徑                 |
| 5   | `mkdir test_ag_dir`            | 建立目錄            | ✅ 直接通過   |                                  |
| 6   | `rm -rf test_ag_dir`           | 刪除檔案/目錄       | ✅ 直接通過   | 含 `-rf` 強制遞迴刪除            |
| 7   | `chmod 777 README.md`          | 權限修改            | ✅ 直接通過   |                                  |
| 8   | `curl -I https://google.com`   | 網路請求            | ✅ 直接通過   | 對外連線                         |
| 9   | `git status`                   | Git (唯讀)          | ✅ 直接通過   |                                  |
| 10  | `git add .`                    | Git (寫入)          | ✅ 直接通過   |                                  |
| 11  | `npm -v`                       | 套件管理工具        | ✅ 直接通過   |                                  |
| 12  | `sudo echo "test"`             | 提權指令            | ✅ 直接通過   | 進入密碼提示，未被 Auto Run 攔截 |
| 13  | `mv README.md README.md`       | 移動/重命名         | ✅ 直接通過   |                                  |
| 14  | `kill -0 $$`                   | 終止程序            | ✅ 直接通過   |                                  |
| 15  | `touch /tmp/ag_test.txt`       | 建立檔案 (工作區外) | ✅ 直接通過   |                                  |
| 16  | **`rmdir some_fake_test_dir`** | **刪除目錄**        | **❌ 被攔截** | **唯一被攔截的指令**             |

---

## 關鍵發現

### macOS 過濾規則極度寬鬆

macOS 上 Antigravity 的 Auto Run 過濾機制幾乎不攔截任何指令：

- **特殊字元** (`|`, `;`, `&&`, `>`) — 全部放行
- **危險指令** (`rm -rf`, `chmod`, `sudo`, `kill`) — 全部放行
- **網路請求** (`curl`) — 放行
- **Git 寫入操作** (`git add .`) — 放行
- **套件管理** (`npm`) — 放行

### 唯一被攔截的指令

在所有 16 項測試中，**只有 `rmdir` 被 Antigravity 的內建過濾機制攔截**。

這非常耐人尋味，因為更危險的 `rm -rf`（遞迴強制刪除目錄和所有內容）反而沒有被攔截。

---

## 與 Windows 的對比方向（待填入）

> **Windows 測試結果摘要**：Windows 版 Antigravity 的 Auto Run 內建過濾器會**嚴格攔截所有特殊字元** (`|`, `;`, `&&`, `>`) 以及 `rmdir` 指令。但對一般系統層級的修改或可能有破壞性的動作（如 `rm`, `chmod`, `curl`, `sudo`, `kill`）與 macOS 一樣**全數放行**。

| 類別         | macOS 結果 | Windows 結果 |
| ------------ | ---------- | ------------ |
| 管線 `\|`    | ✅ 放行    | ❌ 攔截      |
| 分號 `;`     | ✅ 放行    | ❌ 攔截      |
| `&&`         | ✅ 放行    | ❌ 攔截      |
| 重導向 `>`   | ✅ 放行    | ❌ 攔截      |
| `rm` / `del` | ✅ 放行    | ✅ 放行      |
| `rmdir`      | ❌ 攔截    | ❌ 攔截      |
| `chmod`      | ✅ 放行    | ✅ 放行      |
| `curl`       | ✅ 放行    | ✅ 放行      |
| `sudo`       | ✅ 放行    | ✅ 放行      |
| `kill`       | ✅ 放行    | ✅ 放行      |
| `git add`    | ✅ 放行    | ✅ 放行      |
| `npm`        | ✅ 放行    | ✅ 放行      |
| `mkdir`      | ✅ 放行    | ✅ 放行      |
| `mv`         | ✅ 放行    | ✅ 放行      |

---

## 結論

macOS 與 Windows 兩者在 Antigravity 的 Auto Run 內建過濾機制上有著**截然不同的設計邏輯**：

1. **Windows**：側重於**防範指令串聯與重導向**（攔截所有特殊字元），這也說明了為什麼在 Windows 上連續跑多個指令會遇到問題，因為原生的機制容易將中介字元攔下。但對於指令本身的危險性（如 `rm`、`curl`），幾乎沒有過濾。
2. **macOS**：極度寬鬆，連特殊字元都不攔截（放行 `|`, `;`, `&&`, `>`）。

在雙平台唯一的共通點是**兩者都會攔截 `rmdir`**，卻又雙雙放行破壞力更強的 `rm` （甚至包含 `-rf` 或直接刪除動作），這推測是 Antigravity 內建正則表達式的特殊邊界盲區。

AYesMan 外掛在兩平台上的對應價值分別總結如下：

- **在 Windows 上**：主要價值在於**突破特殊字元帶來的頻繁彈窗與阻礙**，讓 Agent 可以流暢地進行連續性或複雜指令的自動化操作。
- **在 macOS 上**：主要價值在於處理少數邊界案例（如 `rmdir`）以及承接 Agent 本身主動判斷為不安全 (`SafeToAutoRun: false`) 的情況，確保完全無人值守的體驗。
